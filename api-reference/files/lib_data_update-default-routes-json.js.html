<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/data/update-default-routes-json.js - wpapi</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                    <h1 class="project-name">wpapi</h1> <span class="project-version">1.0.2</span>
                    <p class="description">An isomorphic JavaScript client for interacting with the WordPress REST API</p>
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">index</a></li>
                <li><a href="#top" class="top-jump-link">top</a></li>
            </ul>
        </div>
    </header>
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <li><a href="#api-classes">Classes</a></li>
                        <li><a href="#api-modules">Modules</a></li>
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes">
                            <li><a class="type" href="../classes/WPAPI.html">WPAPI</a></li>
                            <li><a class="type" href="../classes/WPRequest.html">WPRequest</a></li>
                        </ul>
            
                        <ul id="api-modules" class="apis modules">
                            <li><a class="module" href="../modules/autodiscovery.html">autodiscovery</a></li>
                            <li><a class="module" href="../modules/filters.html">filters</a></li>
                            <li><a class="module" href="../modules/http-transport.html">http-transport</a></li>
                            <li><a class="module" href="../modules/object-reduce.html">object-reduce</a></li>
                            <li><a class="module" href="../modules/parseRouteString.html">parseRouteString</a></li>
                            <li><a class="module" href="../modules/WPAPI.html">WPAPI</a></li>
                            <li><a class="module" href="../modules/WPRequest.html">WPRequest</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: lib/data/update-default-routes-json.js</h1>
                
                <div class="file">
                    <pre class="code prettyprint linenums">
                #!/bin/sh
                &#x27;:&#x27; //; exec &quot;$(command -v nodejs || command -v node)&quot; &quot;$0&quot; &quot;$@&quot;
                // ^^^ Lovely polyglot script to permit usage via node _or_ via bash: see
                // http://unix.stackexchange.com/questions/65235/universal-node-js-shebang
                
                /**
                 * To avoid requiring that auto-discovery be utilized every time the API client
                 * is initialized, this library ships with a built-in route definition from a
                 * vanilla WordPress REST API installation. That file may be updated by
                 * installing the API plugin on a clean WP development instance, with no other
                 * plugins running, and downloading the JSON output from &#x60;yourwpsite.com/wp-json/&#x60;
                 * into the &quot;default-routes.json&quot; file in this directory.
                 *
                 * That file can also be generated by running this script against the same live
                 * WP REST API instance to download that same file, the difference being that,
                 * if the &#x60;default-routes.json&#x60; file is downloaded through this script, it
                 * will be run through the &#x60;simplifyObject&#x60; utility to cut out about 1/3 of the
                 * bytes of the response by removing properties that do not effect route generation.
                 *
                 * This script is NOT intended to be a dependency of any part of wp.js, and is
                 * provided purely as a utility for upgrading the built-in copy of the endpoint
                 * response JSON file that is used to bootstrap the default route handlers.
                 *
                 * @example
                 *
                 *     # Invoke directly, run against default endpoint (details below)
                 *     ./update-default-routes-json.js
                 *
                 *     # Invoke with &#x60;node&#x60; CLI, run against default endpoint
                 *     node ./update-default-routes-json --endpoint=http://my-site.com/wp-json
                 *
                 * This script runs against http://wpapi.loc/wp-json by default, but it can be
                 * run against an arbitrary WordPress REST API endpoint by passing the --endpoint
                 * argument on the CLI:
                 *
                 * @example
                 *
                 *     # Invoke directly, run against an arbitrary WordPress API root
                 *     ./update-default-routes-json.js --endpoint=http://my-site.com/wp-json
                 *
                 *     # Invoke with &#x60;node&#x60; CLI, run against an arbitrary WordPress API root
                 *     node ./update-default-routes-json --endpoint=http://my-site.com/wp-json
                 *
                 * Either form will update the &#x60;default-routes.json&#x60; file in this directory,
                 * providing that the endpoint data is downloaded successfully.
                 *
                 * This script also has some utility for downloading a custom JSON file for your
                 * own WP REST API-enabled site, so that you can bootstrap your own routes without
                 * incurring an HTTP request. To output to a different directory than the default
                 * (which is this directory, &#x60;lib/data/&#x60;), pass an --output argument on the CLI:
                 *
                 * @example
                 *
                 *     # Output to your current working directory
                 *     ./path/to/this/dir/update-default-routes-json.js --output=.
                 *
                 *     # Output to an arbitrary absolute path
                 *     ./path/to/this/dir/update-default-routes-json.js --output=/home/mordor/output.json
                 *
                 * These command-line flags may be combined, and you will usually want to use
                 * --endpoint alongside --output to download your own JSON into your own directory.
                 */
                &#x27;use strict&#x27;;
                
                var agent = require( &#x27;superagent&#x27; );
                var fs = require( &#x27;fs&#x27; );
                var path = require( &#x27;path&#x27; );
                var simplifyObject = require( &#x27;./simplify-object&#x27; );
                
                // Parse the arguments object
                var argv = require( &#x27;minimist&#x27; )( process.argv.slice( 2 ) );
                
                // The output directory defaults to the lib/data directory. To customize it,
                // specify your own directory with --output=your/output/directory (supports
                // both relative and absolute paths)
                var outputPath = argv.output ?
                	// Nested ternary, don&#x27;t try this at home: this is to support absolute paths
                	argv.output[ 0 ] === &#x27;/&#x27; ? argv.output : path.join( process.cwd(), argv.output ) :
                	path.dirname( __filename );
                
                // Specify your own API endpoint with --endpoint=http://your-endpoint.com/wp-json
                var endpoint = argv.endpoint || &#x27;http://wpapi.loc/wp-json&#x27;;
                
                // This directory will be called to kick off the JSON download: it uses
                // superagent internally for HTTP transport that respects HTTP redirects.
                function getJSON( cbFn ) {
                	agent
                		.get( endpoint )
                		.set( &#x27;Accept&#x27;, &#x27;application/json&#x27; )
                		.end(function( err, res ) {
                			// Inspect the error and then the response to infer various error states
                			if ( err ) {
                				console.error( &#x27;\nSomething went wrong! Could not download endpoint JSON.&#x27; );
                				if ( err.status ) {
                					console.error( &#x27;Error &#x27; + err.status );
                				}
                				if ( err.response &amp;&amp; err.response.error ) {
                					console.error( err.response.error );
                				}
                				return process.exit( 1 );
                			}
                
                			if ( res.type !== &#x27;application/json&#x27; ) {
                				console.error( &#x27;\nError: expected response type &quot;application/json&quot;, got &#x27; + res.type );
                				console.error( &#x27;Could not save default-routes.json&#x27; );
                				return process.exit( 1 );
                			}
                
                			cbFn( res );
                		});
                }
                
                // The only assumption we want to make about the URL is that it should be a web
                // URL of _some_ sort, which generally means it has &quot;http&quot; in it somewhere. We
                // can&#x27;t assume much else due to how customizable the location of API root is
                // within your WP install.
                if ( ! /http/i.test( endpoint ) ) {
                	console.error( &#x27;\nError: &#x27; + endpoint );
                	console.error( &#x27;This does not appear to be a valid URL. Please double-check the URL format\n&#x27; +
                		&#x27;(should be e.g. &quot;http://your-domain.com/wp-json&quot;) and try again.&#x27; );
                	process.exit( 1 );
                }
                
                fs.stat( outputPath, function( err, stats ) {
                	if ( err || ! stats.isDirectory() ) {
                		console.error( &#x27;\nError: &#x27; + outputPath );
                		console.error( &#x27;This is not a valid directory. Please double-check the path and try again.&#x27; );
                		process.exit( 1 );
                	}
                
                	// If we made it this far, our arguments look good! Carry on.
                	getJSON(function( response ) {
                		// Extract the JSON
                		var endpointJSON = JSON.parse( JSON.stringify( response.body ) );
                		// Simplify the JSON structure and pick out the routes dictionary
                		var slimJSON = simplifyObject( endpointJSON ).routes;
                
                		// Save the file
                		var outputFilePath = path.join( outputPath, &#x27;default-routes.json&#x27; );
                		fs.writeFile( outputFilePath, JSON.stringify( slimJSON ), function( err ) {
                			if ( err ) {
                				console.error( &#x27;\nSomething went wrong! Could not save &#x27; + outputFilePath );
                				return process.exit( 1 );
                			}
                			console.log( &#x27;\nSuccessfully saved &#x27; + outputFilePath );
                		});
                	});
                });
                
                    </pre>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-offscreen-trigger.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
