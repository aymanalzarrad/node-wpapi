<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>wpapi.js - wpapi</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                    <h1 class="project-name">wpapi</h1> <span class="project-version">1.0.2</span>
                    <p class="description">An isomorphic JavaScript client for interacting with the WordPress REST API</p>
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">index</a></li>
                <li><a href="#top" class="top-jump-link">top</a></li>
            </ul>
        </div>
    </header>
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <li><a href="#api-classes">Classes</a></li>
                        <li><a href="#api-modules">Modules</a></li>
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes">
                            <li><a class="type" href="../classes/WPAPI.html">WPAPI</a></li>
                            <li><a class="type" href="../classes/WPRequest.html">WPRequest</a></li>
                        </ul>
            
                        <ul id="api-modules" class="apis modules">
                            <li><a class="module" href="../modules/autodiscovery.html">autodiscovery</a></li>
                            <li><a class="module" href="../modules/filters.html">filters</a></li>
                            <li><a class="module" href="../modules/http-transport.html">http-transport</a></li>
                            <li><a class="module" href="../modules/object-reduce.html">object-reduce</a></li>
                            <li><a class="module" href="../modules/parseRouteString.html">parseRouteString</a></li>
                            <li><a class="module" href="../modules/WPAPI.html">WPAPI</a></li>
                            <li><a class="module" href="../modules/WPRequest.html">WPRequest</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: wpapi.js</h1>
                
                <div class="file">
                    <pre class="code prettyprint linenums">
                /**
                 * A WP REST API client for Node.js
                 *
                 * @example
                 *     var wp = new WPAPI({ endpoint: &#x27;http://src.wordpress-develop.dev/wp-json&#x27; });
                 *     wp.posts().then(function( posts ) {
                 *         console.log( posts );
                 *     }).catch(function( err ) {
                 *         console.error( err );
                 *     });
                 *
                 * @module WPAPI
                 * @main WPAPI
                 })
                 */
                &#x27;use strict&#x27;;
                
                var extend = require( &#x27;node.extend&#x27; );
                var objectReduce = require( &#x27;./lib/util/object-reduce&#x27; );
                
                // This JSON file provides enough data to create handler methods for all valid
                // API routes in WordPress 4.7
                var defaultRoutes = require( &#x27;./lib/data/default-routes.json&#x27; );
                var buildRouteTree = require( &#x27;./lib/route-tree&#x27; ).build;
                var generateEndpointFactories = require( &#x27;./lib/endpoint-factories&#x27; ).generate;
                
                // The default endpoint factories will be lazy-loaded by parsing the default
                // route tree data if a default-mode WPAPI instance is created (i.e. one that
                // is to be bootstrapped with the handlers for all of the built-in routes)
                var defaultEndpointFactories;
                
                // Constant used to detect first-party WordPress REST API routes
                var apiDefaultNamespace = &#x27;wp/v2&#x27;;
                
                // Pull in autodiscovery methods
                var autodiscovery = require( &#x27;./lib/autodiscovery&#x27; );
                
                // Pull in base module constructors
                var WPRequest = require( &#x27;./lib/constructors/wp-request&#x27; );
                
                // Pull in default HTTP transport
                var httpTransport = require( &#x27;./lib/http-transport&#x27; );
                
                /**
                 * The base constructor for the WP API service
                 *
                 * @class WPAPI
                 * @constructor
                 * @uses WPRequest
                 * @param {Object} options             An options hash to configure the instance
                 * @param {String} options.endpoint    The URI for a WP-API endpoint
                 * @param {String} [options.username]  A WP-API Basic Auth username
                 * @param {String} [options.password]  A WP-API Basic Auth password
                 * @param {String} [options.nonce]     A WP nonce for use with cookie authentication
                 * @param {Object} [options.routes]    A dictionary of API routes with which to
                 *                                     bootstrap the WPAPI instance: the instance will
                 *                                     be initialized with default routes only
                 *                                     if this property is omitted
                 * @param {String} [options.transport] An optional dictionary of HTTP transport
                 *                                     methods (.get, .post, .put, .delete, .head)
                 *                                     to use instead of the defaults, e.g. to use
                 *                                     a different HTTP library than superagent
                 */
                function WPAPI( options ) {
                
                	// Enforce &#x60;new&#x60;
                	if ( this instanceof WPAPI === false ) {
                		return new WPAPI( options );
                	}
                
                	if ( typeof options.endpoint !== &#x27;string&#x27; ) {
                		throw new Error( &#x27;options hash must contain an API endpoint URL string&#x27; );
                	}
                
                	// Dictionary to be filled by handlers for default namespaces
                	this._ns = {};
                
                	this._options = {
                		// Ensure trailing slash on endpoint URI
                		endpoint: options.endpoint.replace(  /\/?$/, &#x27;/&#x27; )
                	};
                
                	// If any authentication credentials were provided, assign them now
                	if ( options &amp;&amp; ( options.username || options.password || options.nonce ) ) {
                		this.auth( options );
                	}
                
                	return this
                		// Configure custom HTTP transport methods, if provided
                		.transport( options.transport )
                		// Bootstrap with a specific routes object, if provided
                		.bootstrap( options &amp;&amp; options.routes );
                }
                
                /**
                 * Set custom transport methods to use when making HTTP requests against the API
                 *
                 * Pass an object with a function for one or many of &quot;get&quot;, &quot;post&quot;, &quot;put&quot;,
                 * &quot;delete&quot; and &quot;head&quot; and that function will be called when making that type
                 * of request. The provided transport functions should take a WPRequest handler
                 * instance (_e.g._ the result of a &#x60;wp.posts()...&#x60; chain or any other chaining
                 * request handler) as their first argument; a &#x60;data&#x60; object as their second
                 * argument (for POST, PUT and DELETE requests); and an optional callback as
                 * their final argument. Transport methods should invoke the callback with the
                 * response data (or error, as appropriate), and should also return a Promise.
                 *
                 * @example showing how a cache hit (keyed by URI) could short-circuit a get request
                 *
                 *     var site = new WPAPI({
                 *       endpoint: &#x27;http://my-site.com/wp-json&#x27;
                 *     });
                 *
                 *     // Overwrite the GET behavior to inject a caching layer
                 *     site.transport({
                 *       get: function( wpreq, cb ) {
                 *         var result = cache[ wpreq ];
                 *         // If a cache hit is found, return it via the same callback/promise
                 *         // signature as the default transport method
                 *         if ( result ) {
                 *           if ( cb &amp;&amp; typeof cb === &#x27;function&#x27; ) {
                 *             cb( null, result );
                 *           }
                 *           return Promise.resolve( result );
                 *         }
                 *
                 *         // Delegate to default transport if no cached data was found
                 *         return WPAPI.transport.get( wpreq, cb ).then(function( result ) {
                 *           cache[ wpreq ] = result;
                 *           return result;
                 *         });
                 *       }
                 *     });
                 *
                 * This is advanced behavior; you will only need to utilize this functionality
                 * if your application has very specific HTTP handling or caching requirements.
                 * Refer to the &quot;http-transport&quot; module within this application for the code
                 * implementing the built-in transport methods.
                 *
                 * @chainable
                 * @param {Object}   transport          A dictionary of HTTP transport methods
                 * @param {Function} [transport.get]    The function to use for GET requests
                 * @param {Function} [transport.post]   The function to use for POST requests
                 * @param {Function} [transport.put]    The function to use for PUT requests
                 * @param {Function} [transport.delete] The function to use for DELETE requests
                 * @param {Function} [transport.head]   The function to use for HEAD requests
                 * @returns {WPAPI} The WPAPI instance, for chaining
                 */
                WPAPI.prototype.transport = function( transport ) {
                	// Local reference to avoid need to reference via &#x60;this&#x60; inside forEach
                	var _options = this._options;
                
                	// Create the default transport if it does not exist
                	if ( ! _options.transport ) {
                		_options.transport = Object.create( WPAPI.transport );
                	}
                
                	// Whitelist the methods that may be applied
                	[ &#x27;get&#x27;, &#x27;head&#x27;, &#x27;post&#x27;, &#x27;put&#x27;, &#x27;delete&#x27; ].forEach(function( key ) {
                		if ( transport &amp;&amp; transport[ key ] ) {
                			_options.transport[ key ] = transport[ key ];
                		}
                	});
                
                	return this;
                };
                
                /**
                 * Default HTTP transport methods object for all WPAPI instances
                 *
                 * These methods may be extended or replaced on an instance-by-instance basis
                 *
                 * @static
                 * @property transport
                 * @type {Object}
                 */
                WPAPI.transport = Object.create( httpTransport );
                Object.freeze( WPAPI.transport );
                
                /**
                 * Convenience method for making a new WPAPI instance
                 *
                 * @example
                 * These are equivalent:
                 *
                 *     var wp = new WPAPI({ endpoint: &#x27;http://my.blog.url/wp-json&#x27; });
                 *     var wp = WPAPI.site( &#x27;http://my.blog.url/wp-json&#x27; );
                 *
                 * &#x60;WPAPI.site&#x60; can take an optional API root response JSON object to use when
                 * bootstrapping the client&#x27;s endpoint handler methods: if no second parameter
                 * is provided, the client instance is assumed to be using the default API
                 * with no additional plugins and is initialized with handlers for only those
                 * default API routes.
                 *
                 * @example
                 * These are equivalent:
                 *
                 *     // {...} means the JSON output of http://my.blog.url/wp-json
                 *     var wp = new WPAPI({
                 *       endpoint: &#x27;http://my.blog.url/wp-json&#x27;,
                 *       json: {...}
                 *     });
                 *     var wp = WPAPI.site( &#x27;http://my.blog.url/wp-json&#x27;, {...} );
                 *
                 * @method site
                 * @static
                 * @param {String} endpoint The URI for a WP-API endpoint
                 * @param {Object} routes   The &quot;routes&quot; object from the JSON object returned
                 *                          from the root API endpoint of a WP site, which should
                 *                          be a dictionary of route definition objects keyed by
                 *                          the route&#x27;s regex pattern
                 * @return {WPAPI} A new WPAPI instance, bound to the provided endpoint
                 */
                WPAPI.site = function( endpoint, routes ) {
                	return new WPAPI({
                		endpoint: endpoint,
                		routes: routes
                	});
                };
                
                /**
                 * Generate a request against a completely arbitrary endpoint, with no assumptions about
                 * or mutation of path, filtering, or query parameters. This request is not restricted to
                 * the endpoint specified during WPAPI object instantiation.
                 *
                 * @example
                 * Generate a request to the explicit URL &quot;http://your.website.com/wp-json/some/custom/path&quot;
                 *
                 *     wp.url( &#x27;http://your.website.com/wp-json/some/custom/path&#x27; ).get()...
                 *
                 * @method url
                 * @param {String} url The URL to request
                 * @return {WPRequest} A WPRequest object bound to the provided URL
                 */
                WPAPI.prototype.url = function( url ) {
                	var options = extend( {}, this._options, {
                		endpoint: url
                	});
                	return new WPRequest( options );
                };
                
                /**
                 * Generate a query against an arbitrary path on the current endpoint. This is useful for
                 * requesting resources at custom WP-API endpoints, such as WooCommerce&#x27;s &#x60;/products&#x60;.
                 *
                 * @method root
                 * @param {String} [relativePath] An endpoint-relative path to which to bind the request
                 * @return {WPRequest} A request object
                 */
                WPAPI.prototype.root = function( relativePath ) {
                	relativePath = relativePath || &#x27;&#x27;;
                	var options = extend( {}, this._options );
                	// Request should be
                	var request = new WPRequest( options );
                
                	// Set the path template to the string passed in
                	request._path = { &#x27;0&#x27;: relativePath };
                
                	return request;
                };
                
                /**
                 * Set the authentication to use for a WPAPI site handler instance. Accepts basic
                 * HTTP authentication credentials (string username &amp; password) or a Nonce (for
                 * cookie authentication) by default; may be overloaded to accept OAuth credentials
                 * in the future.
                 *
                 * @example Basic Authentication
                 *
                 *     site.auth({
                 *       username: &#x27;admin&#x27;,
                 *       password: &#x27;securepass55&#x27;
                 *     })...
                 *
                 * @example Cookie/Nonce Authentication
                 *
                 *     site.auth({
                 *       nonce: &#x27;somenonce&#x27;
                 *     })...
                 *
                 * @method auth
                 * @chainable
                 * @param {Object} credentials            An authentication credentials object
                 * @param {String} [credentials.username] A WP-API Basic HTTP Authentication username
                 * @param {String} [credentials.password] A WP-API Basic HTTP Authentication password
                 * @param {String} [credentials.nonce]    A WP nonce for use with cookie authentication
                 * @return {WPAPI} The WPAPI site handler instance, for chaining
                 */
                WPAPI.prototype.auth = WPRequest.prototype.auth;
                
                // Apply the registerRoute method to the prototype
                WPAPI.prototype.registerRoute = require( &#x27;./lib/wp-register-route&#x27; );
                
                /**
                 * Deduce request methods from a provided API root JSON response object&#x27;s
                 * routes dictionary, and assign those methods to the current instance. If
                 * no routes dictionary is provided then the instance will be bootstrapped
                 * with route handlers for the default API endpoints only.
                 *
                 * This method is called automatically during WPAPI instance creation.
                 *
                 * @method bootstrap
                 * @chainable
                 * @param {Object} routes The &quot;routes&quot; object from the JSON object returned
                 *                        from the root API endpoint of a WP site, which should
                 *                        be a dictionary of route definition objects keyed by
                 *                        the route&#x27;s regex pattern
                 * @return {WPAPI} The bootstrapped WPAPI client instance (for chaining or assignment)
                 */
                WPAPI.prototype.bootstrap = function( routes ) {
                	var routesByNamespace;
                	var endpointFactoriesByNamespace;
                
                	if ( ! routes ) {
                		// Auto-generate default endpoint factories if they are not already available
                		if ( ! defaultEndpointFactories ) {
                			routesByNamespace = buildRouteTree( defaultRoutes );
                			defaultEndpointFactories = generateEndpointFactories( routesByNamespace );
                		}
                		endpointFactoriesByNamespace = defaultEndpointFactories;
                	} else {
                		routesByNamespace = buildRouteTree( routes );
                		endpointFactoriesByNamespace = generateEndpointFactories( routesByNamespace );
                	}
                
                	// For each namespace for which routes were identified, store the generated
                	// route handlers on the WPAPI instance&#x27;s private _ns dictionary. These namespaced
                	// handler methods can be accessed by calling &#x60;.namespace( str )&#x60; on the
                	// client instance and passing a registered namespace string.
                	// Handlers for default (wp/v2) routes will also be assigned to the WPAPI
                	// client instance object itself, for brevity.
                	return objectReduce( endpointFactoriesByNamespace, function( wpInstance, endpointFactories, namespace ) {
                
                		// Set (or augment) the route handler factories for this namespace.
                		wpInstance._ns[ namespace ] = objectReduce( endpointFactories, function( nsHandlers, handlerFn, methodName ) {
                			nsHandlers[ methodName ] = handlerFn;
                			return nsHandlers;
                		}, wpInstance._ns[ namespace ] || {
                			// Create all namespace dictionaries with a direct reference to the main WPAPI
                			// instance&#x27;s _options property so that things like auth propagate properly
                			_options: wpInstance._options
                		} );
                
                		// For the default namespace, e.g. &quot;wp/v2&quot; at the time this comment was
                		// written, ensure all methods are assigned to the root client object itself
                		// in addition to the private _ns dictionary: this is done so that these
                		// methods can be called with e.g. &#x60;wp.posts()&#x60; and not the more verbose
                		// &#x60;wp.namespace( &#x27;wp/v2&#x27; ).posts()&#x60;.
                		if ( namespace === apiDefaultNamespace ) {
                			Object.keys( wpInstance._ns[ namespace ] ).forEach(function( methodName ) {
                				wpInstance[ methodName ] = wpInstance._ns[ namespace ][ methodName ];
                			});
                		}
                
                		return wpInstance;
                	}, this );
                };
                
                /**
                 * Access API endpoint handlers from a particular API namespace object
                 *
                 * @example
                 *
                 *     wp.namespace( &#x27;myplugin/v1&#x27; ).author()...
                 *
                 *     // Default WP endpoint handlers are assigned to the wp instance itself.
                 *     // These are equivalent:
                 *     wp.namespace( &#x27;wp/v2&#x27; ).posts()...
                 *     wp.posts()...
                 *
                 * @param {string} namespace A namespace string
                 * @returns {Object} An object of route endpoint handler methods for the
                 * routes within the specified namespace
                 */
                WPAPI.prototype.namespace = function( namespace ) {
                	if ( ! this._ns[ namespace ] ) {
                		throw new Error( &#x27;Error: namespace &#x27; + namespace + &#x27; is not recognized&#x27; );
                	}
                	return this._ns[ namespace ];
                };
                
                /**
                 * Take an arbitrary WordPress site, deduce the WP REST API root endpoint, query
                 * that endpoint, and parse the response JSON. Use the returned JSON response
                 * to instantiate a WPAPI instance bound to the provided site.
                 *
                 * @method discover
                 * @static
                 * @param {string} url A URL within a REST API-enabled WordPress website
                 * @return {Promise} A promise that resolves to a configured WPAPI instance bound
                 * to the deduced endpoint, or rejected if an endpoint is not found or the
                 * library is unable to parse the provided endpoint.
                 */
                WPAPI.discover = function( url ) {
                	// local placeholder for API root URL
                	var endpoint;
                
                	// Try HEAD request first, for smaller payload: use WPAPI.site to produce
                	// a request that utilizes the defined HTTP transports
                	var req = WPAPI.site( url ).root();
                	return req.headers()
                		.catch(function() {
                			// On the hypothesis that any error here is related to the HEAD request
                			// failing, provisionally try again using GET because that method is
                			// more widely supported
                			return req.get();
                		})
                		// Inspect response to find API location header
                		.then( autodiscovery.locateAPIRootHeader )
                		.then(function( apiRootURL ) {
                			// Set the function-scope variable that will be used to instantiate
                			// the bound WPAPI instance,
                			endpoint = apiRootURL;
                
                			// then GET the API root JSON object
                			return WPAPI.site( apiRootURL ).root().get();
                		})
                		.then(function( apiRootJSON ) {
                			// Instantiate &amp; bootstrap with the discovered methods
                			return new WPAPI({
                				endpoint: endpoint,
                				routes: apiRootJSON.routes
                			});
                		})
                		.catch(function( err ) {
                			console.error( err );
                			if ( endpoint ) {
                				console.warn( &#x27;Endpoint detected, proceeding despite error...&#x27; );
                				console.warn( &#x27;Binding to &#x27; + endpoint + &#x27; and assuming default routes&#x27; );
                				return new WPAPI.site( endpoint );
                			}
                			throw new Error( &#x27;Autodiscovery failed&#x27; );
                		});
                };
                
                module.exports = WPAPI;
                
                    </pre>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-offscreen-trigger.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
